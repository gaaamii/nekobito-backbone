define(["jquery","underscore","marked","models/draft","collections/drafts","views/draft","bootstrap"],function(t,e,i,s,r,a){var d=Backbone.View.extend({el:"body",initialize:function(){r.fetch(),this.draftId="",this.$navigation=t(".navbar-default"),this.$sidebar=t("#sidebar"),this.$draftsList=t("#draftsList"),this.$title=t("#title"),this.$body=t("#body"),this.$notice=t("#notice"),this.$preview=t("#preview"),this.$previewTitle=t("#preview-title"),this.$previewBody=t("#preview-body"),this.listenTo(r,"add",this.prependDraft),this.listenTo(r,"destroy",this.refreshDraftId),this.prependAllDrafts(),this.preview()},events:{keydown:"reactToKey","click .menuBar":"toggleList","click .draft-item":"openDraft","focus #editor":"focusOnEditor","blur #editor":"blurEditor","keyup #editor":"preview","click #saveBtn":"saveDraft","click #deleteBtn":"destroyDraft","click #addBtn":"openBlank"},blurEditor:function(){this.$navigation.css("opacity","1.0")},focusOnEditor:function(){this.hideSidebar(),this.$navigation.animate({opacity:"0.3"})},updateCharacters:function(){},reactToKey:function(t){t.ctrlKey&&(83===t.keyCode?this.saveDraft():76===t.keyCode?this.toggleList():68===t.keyCode?this.destroyDraft():78===t.keyCode&&this.openBlank())},attachVimLikeKey:function(){var e=-1,i=this.$draftsList.children(),s=t(i[e]).addClass("selected");this.$el.on("keypress",function(r){106===r.keyCode?e<i.length-1&&(s.removeClass("selected"),e++,s=t(i[e]).addClass("selected")):107===r.keyCode?e>=0&&(s.removeClass("selected"),e--,s=t(i[e]).addClass("selected")):111===r.keyCode&&s.click()})},detachVimLikeKey:function(){this.$draftsList.find(".selected").removeClass("selected"),this.$el.off("keypress")},refreshDraftId:function(t){this.draftId=t||""},destroyDraft:function(){this.draftId?confirm("Are you sure?")&&(r.get(this.draftId).destroy(),this.openBlank()):alert("Not selected.")},openBlank:function(){this.hideSidebar(),this.setDraft(""),this.preview(),this.$title.focus(),this.refreshDraftId()},openDraft:function(e){this.hideSidebar(),this.draftId=t(e.target).attr("data-cid")},showSidebar:function(){var t=this;t.attachVimLikeKey(),t.$sidebar.animate({"margin-left":0,display:"block"},50,function(){t.$title.blur(),t.$body.blur()})},hideSidebar:function(){this.$sidebar.animate({"margin-left":"-250px"},100,this.detachVimLikeKey())},prependDraft:function(t){var e=new a({model:t});this.$draftsList.prepend(e.render().el)},prependAllDrafts:function(){r.each(this.prependDraft,this)},toggleList:function(){"-250px"===this.$sidebar.css("margin-left")?this.showSidebar():this.hideSidebar()},preview:function(){this.$previewTitle.html(this.$title.val()),this.$previewBody.html(i(this.$body.val()))},attrsOnEditor:function(){return{title:this.$title.val().trim(),body:this.$body.val()}},saveDraft:function(){var t,e;t=this.draftId?r.get(this.draftId).set(this.attrsOnEditor()):new s(this.attrsOnEditor()),t.isValid()?(r.create(t),this.refreshDraftId(t.id),e="Saved."):e=t.validationError,this.notice(e)},notice:function(t){this.$notice.text(t).fadeIn(300).fadeOut(800)},setDraft:function(t){t?(this.$title.val(t.get("title")),this.$body.val(t.get("body"))):(this.$title.val(""),this.$body.val(""))}});return d});